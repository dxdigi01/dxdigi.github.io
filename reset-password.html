<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ” Åifre SÄ±fÄ±rlama - DxDebt</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
      min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)
    }
    .card{
      width:100%;max-width:420px;background:#fff;border-radius:16px;padding:36px;text-align:center;
      box-shadow:0 20px 50px rgba(0,0,0,.25)
    }
    .icon{font-size:64px;margin-bottom:18px}
    h1{font-size:24px;color:#333;margin-bottom:8px}
    p{color:#666;margin-bottom:24px}
    .status{padding:16px;border-radius:12px;margin-bottom:16px;font-size:15px}
    .loading{background:#e3f2fd;color:#1565c0}
    .success{background:#e8f5e9;color:#2e7d32}
    .error{background:#ffebee;color:#c62828}
    button{
      width:100%;padding:14px 0;border:none;border-radius:10px;background:#667eea;color:#fff;
      font-size:16px;font-weight:600;cursor:pointer;transition:.2s
    }
    button:disabled{background:#b0bec5;cursor:not-allowed}
    .hint{font-size:12px;color:#8a8a8a;margin-top:14px}
    .token-preview{font-size:12px;color:#555;background:#f5f5f5;padding:8px;border-radius:8px;margin-top:10px;word-break:break-all}
  </style>
</head>
<body>
  <div class="card">
    <div class="icon">ğŸ”</div>
    <h1>Åifre SÄ±fÄ±rlama</h1>
    <p>Uygulamaya geÃ§meniz birkaÃ§ saniye sÃ¼rebilir. Otomatik aÃ§Ä±lmazsa butona dokunun.</p>

    <div id="status" class="status loading">
      <span id="statusText">Mobil uygulamaya yÃ¶nlendiriliyorsunuz...</span>
    </div>

    <div id="tokenPreview" class="token-preview" style="display:none;"></div>

    <button id="openBtn" disabled>DxDebt UygulamasÄ±nÄ± AÃ§</button>
    <div class="hint">Bu sayfa tokenâ€™larÄ± saklamaz; sadece uygulamaya iletir.</div>
  </div>

  <script>
    const statusBox = document.getElementById('status');
    const statusText = document.getElementById('statusText');
    const openBtn = document.getElementById('openBtn');
    const previewBox = document.getElementById('tokenPreview');

    const rawQuery = window.location.search.replace(/^\?/, '');
    const rawFragment = window.location.hash.replace(/^#/, '');
    const hasQuery = rawQuery.length > 0;
    const hasFragment = rawFragment.length > 0;

    if (!hasQuery && !hasFragment) {
      statusBox.className = 'status error';
      statusText.textContent = 'Token bulunamadÄ±. LÃ¼tfen reset linkini tekrar aÃ§Ä±n.';
    } else {
      const deepLink =
        'dxdebt://reset-password' +
        (hasQuery ? `?${rawQuery}` : '') +
        (hasFragment ? `#${rawFragment}` : '');

      const previewSource = rawFragment || rawQuery;
      previewBox.style.display = 'block';
      previewBox.textContent = previewSource.substring(0, 60) + '...';

      function openApp(userAction) {
        window.location.href = deepLink;
        if (userAction) {
          // intent:// fallback (Android Chrome)
          const intentUrl =
            'intent://reset-password' +
            (hasQuery ? `?${rawQuery}` : '') +
            (hasFragment ? `#${rawFragment}` : '') +
            '#Intent;scheme=dxdebt;package=com.dxdigi.dxdebt;end';
          setTimeout(() => (window.location.href = intentUrl), 300);
        }
        statusBox.className = 'status success';
        statusText.textContent = 'Uygulama aÃ§Ä±lmazsa butona yeniden dokunun.';
      }

      openBtn.disabled = false;
      openBtn.onclick = () => openApp(true);

      // otomatik dene
      openApp(false);
    }
  </script>
</body>
</html>
